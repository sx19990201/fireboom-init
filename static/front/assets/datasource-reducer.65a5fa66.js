import{r as h,a as e,A as Te,g as ve,j as l,F as o,a9 as R,aa as me,aw as je,b as fe,n as Ee,aZ as he}from"./index.bb86fbbf.js";import{B as G}from"./button.aa0bb50b.js";import{I as le}from"./index.da25c8fe.js";import{S as Fe}from"./index.445b6a21.js";import{W as $e}from"./workbenchContext.3d2abc29.js";import{I as k}from"./index.34a54fb6.js";/* empty css               */import{I as A}from"./index.837f2673.js";import{D as p}from"./index.2ab34b44.js";import{l as De}from"./Editor.6c4f1911.js";import{i as v}from"./use-immer.module.c8467ba8.js";import{I as Pe}from"./index.6d8ed736.js";import{F as t}from"./index.2f0a4123.js";import"./row.b57345b2.js";import"./index.61964446.js";import{M as ce}from"./index.bb824a09.js";import{R as ne}from"./index.11df8be1.js";import"./iconUtil.02bc4596.js";import{S as j}from"./index.4c04c22e.js";import{E as Ce}from"./50x.88c69611.js";/* empty css               *//* empty css               */import{T as Ve}from"./Table.134cf6cf.js";import{C as Oe}from"./index.9ea41163.js";import"./Pagination.4574862b.js";import"./Tree.4ceb5bc3.js";import{U as xe,C as ue}from"./index.4aaa6195.js";import{P as ze}from"./index.29ffa237.js";import{S as Re}from"./SearchOutlined.7a88f9ff.js";import{E as Le}from"./index.db465a01.js";import{p as Ue}from"./parser.416ca819.js";/* empty css              */import{S as Se}from"./index.f3604e26.js";import{T as pe}from"./index.d80e831a.js";import{T as qe}from"./styleChecker.d685456c.js";import{P as ke}from"./PlusOutlined.c73517e2.js";import{C as ge}from"./CaretRightOutlined.b47366d4.js";import{T as ye}from"./index.4a2fd767.js";var Me={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm192 472c0 4.4-3.6 8-8 8H544v152c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V544H328c-4.4 0-8-3.6-8-8v-48c0-4.4 3.6-8 8-8h152V328c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v152h152c4.4 0 8 3.6 8 8v48z"}}]},name:"plus-circle",theme:"filled"};const Ze=Me;var _e=function(F,x){return e(Te,{...ve(ve({},F),{},{ref:x,icon:Ze})})};_e.displayName="PlusCircleFilled";const Ge=h.exports.forwardRef(_e);const tl=h.exports.createContext([]),Ie=h.exports.createContext({}),nl=h.exports.createContext({}),ie=h.exports.createContext({});De.config({paths:{vs:"/modules/monaco-editor/min/vs"}});function Qe({content:a}){const{handleSave:F}=h.exports.useContext(ie);h.exports.useContext(Ie);const[x,i]=v(a.name==""),[I,w]=v(""),D=a.config;h.exports.useEffect(()=>{i(a.name=="")},[a]),h.exports.useEffect(()=>{w(D.schema)},[a.config.schema]);const y=n=>{if(n!=""){if(a.name==""||a.name.startsWith("example_")){const B={...a,config:{apiNamespace:n,serverName:n,schema:""},name:n};Reflect.deleteProperty(B,"id"),R.post("/dataSource",B).then(c=>{a.id=c,F(a)})}else{const B={...a,config:{...D,apiNamespace:n,serverName:n},name:n};R.put(`/dataSource/${a.id}`,B).then(()=>{F(B)})}i(!1)}};return l(o,{children:[e("div",{className:"flex justify-center",children:e(p,{bordered:!0,column:1,size:"small",className:"w-full mt-4",children:e(p.Item,{label:"\u8FDE\u63A5\u540D",className:"h-12",children:e(o,{children:x?e(A,{onBlur:n=>y(n.target.value),onPressEnter:n=>y(n.target.value),style:{width:"200px"},defaultValue:D.serverName,autoFocus:!0,placeholder:"\u8BF7\u8F93\u5165\u5916\u90E8\u6570\u636E\u6E90\u540D"}):l(o,{children:[D.apiNamespace,e("span",{onClick:()=>i(!0),className:"ml-3 cursor-pointer",children:e(k,{type:"icon-bianji"})})]})})})})}),e("div",{className:"mt-10 flex items-center justify-between",children:l("span",{className:"ml-2 text-xs text-gray-500/80",children:[e(k,{type:"icon-zhuyi",className:"mr-2"}),"\u4E3B\u8981\u7528\u4E8E\u65E5\u5FD7\u7B49\u526F\u4F5C\u7528\u64CD\u4F5C"]})}),a.name?e(Pe,{hookPath:`customize/${a.name}`,defaultLanguage:"typescript",hideSwitch:!0}):""]})}const We="_monaco_1n7bn_64",He="_modal_1n7bn_72",Ne={"connect-edit-btn":"_connect-edit-btn_1n7bn_1","connect-check-btn":"_connect-check-btn_1n7bn_20","connect-check-btn-common":"_connect-check-btn-common_1n7bn_39","db-check-setting":"_db-check-setting_1n7bn_49","form-contain":"_form-contain_1n7bn_57",monaco:We,"db-setting-table":"_db-setting-table_1n7bn_68",modal:He},Ke="_table_1srlq_1",Je={table:Ke};function Be({beforeUpload:a,setUploadPath:F,setVisible:x,basePath:i,upType:I}){const[w,D]=h.exports.useState([]),[y,n]=h.exports.useState(!1),[B,c]=h.exports.useState(""),Q={name:"file",action:"/api/v1/file/uploadFile",data:{type:I},showUploadList:!1,beforeUpload:a,onChange(f){var E;f.file.status!=="uploading"&&console.log(f.file,f.fileList),f.file.status==="done"?(me.success(`${f.file.name} \u4E0A\u4F20\u6210\u529F`),n(!y)):f.file.status==="error"&&me.error(((E=f.file.response)==null?void 0:E.message)||`${f.file.name} \u4E0A\u4F20\u5931\u8D25`)}},Y=(f,E)=>{E==null||E.stopPropagation(),O(f.name),n(!y)},L=f=>{f==null||f.stopPropagation()};h.exports.useEffect(()=>{R.get(`/file/${I}`).then(f=>{D(I===1?f.files.filter(E=>E.name.endsWith(".json")||E.name.endsWith(".yaml")):f.files)})},[y,I]);function O(f){R.delete("/file/removeFile",{data:{name:f,type:`${I}`}}).then(E=>console.log(E))}const X=[{title:"\u6587\u4EF6\u540D",dataIndex:"name",key:"name",className:"cursor-pointer"},{title:"\u5927\u5C0F",dataIndex:"size",key:"size",width:100},{title:"\u4FEE\u6539\u65F6\u95F4",dataIndex:"modifyTime",key:"modifyTime",width:180},{title:"\u6743\u9650",dataIndex:"permission",key:"permission",width:80},{title:"",dataIndex:"icon",key:"icon",width:80,render:(f,E)=>l("div",{className:"flex items-center justify-between",children:[e(ze,{title:"\u786E\u8BA4\u5220\u9664\uFF1F",onConfirm:$=>Y(E,$),onCancel:L,okText:"\u662F",cancelText:"\u5426",children:e(k,{onClick:$=>$==null?void 0:$.stopPropagation(),type:"icon-shanchu",className:"cursor-pointer",style:{fontSize:"16px",color:"#f6595b"}})}),e("a",{href:`/api/v1/file/downloadFile?type=${I}&fileName=${E.name}`,children:e(k,{onClick:$=>$.stopPropagation(),type:"icon-xiazai",className:"cursor-pointer",style:{fontSize:"22px"}})})]})}];return l(o,{children:[l("div",{className:"flex mb-3 justify-between",children:[e(A,{style:{height:26},className:"h-26px max-w-328px",addonBefore:e(le,{height:14,width:14,src:"/assets/folder.svg",alt:"\u76EE\u5F55",preview:!1}),defaultValue:"./"}),e(xe,{...Q,className:"cursor-pointer flex m-auto h-6 mr-3 w-12 items-center justify-center",children:e(le,{height:16,width:16,src:"/assets/upload.svg",alt:"\u4E0A\u4F20",preview:!1})}),e(A,{value:B,onChange:f=>c(f.target.value),addonBefore:e(Re,{}),style:{width:228,height:26}})]}),e(Ve,{className:Je.table,columns:X,dataSource:w.filter(f=>f.name.includes(B)),pagination:!1,scroll:{x:738,y:455},onRow:f=>({onClick:E=>{F(`${f.name}`),x(!1)},onDoubleClick:E=>{},onContextMenu:E=>{},onMouseEnter:E=>{},onMouseLeave:E=>{}})})]})}const Ye="_head_i7tcr_1",Xe="_btn_i7tcr_5",be={head:Ye,btn:Xe,"ant-select":"_ant-select_i7tcr_13","ant-select-selector":"_ant-select-selector_i7tcr_13"};De.config({paths:{vs:"/modules/monaco-editor/min/vs"}});const ea=({replaceJSON:a,initSchema:F,content:x})=>{const{id:i}=je(),[I,w]=v([]),[D,y]=h.exports.useState([]),[n,B]=h.exports.useState([]),[c,Q]=h.exports.useState([]),[Y,L]=h.exports.useState([]),[O,X]=h.exports.useState(F),[f,E]=h.exports.useState(null);h.exports.useEffect(()=>{!a||w(a.map((s,u)=>({id:u.toString(),table:s.table,field:s.field,resType:s.resType,inputType:s.inputType,isOpen:(s==null?void 0:s.isOpen)||!1})))},[a]),h.exports.useEffect(()=>{if(!!O)try{const s=Ue(O,{noLocation:!0}).definitions,u=s.filter(g=>g.kind==="InputObjectTypeDefinition").map(g=>({label:g.name.value,value:g.name.value}));Q(u);const b=s.filter(g=>g.kind==="ObjectTypeDefinition").map(g=>({label:g.name.value,value:g.name.value}));L(b)}catch{return}},[O]),h.exports.useEffect(()=>{R.get(`/prisma/dmf/${i!=null?i:""}`).then(s=>{const u=s.models.map(b=>({name:b.name,fields:b.fields.map(g=>({name:g.name,title:g.title}))}));return y(u),u}).then(s=>B(s.map(u=>({label:u.name,value:u.name}))))},[i]);function $(s){var b;const u=(b=D.find(g=>g.name===s.table))==null?void 0:b.fields;return u==null?void 0:u.map(g=>({label:g.name,value:g.name}))}function H(s,u){w(b=>{const g=b.find(d=>d.id===u.id);g.table=s})}function P(s,u){w(b=>{const g=b.find(d=>d.id===u.id);g.field=s})}function q(s,u){w(b=>{const g=b.find(d=>d.id===u.id);g.inputType=s})}function ae(s,u){w(b=>{const g=b.find(d=>d.id===u.id);g.resType=s})}function K(s,u){w(b=>{const g=b.find(d=>d.id===u.id);g.isOpen=s})}function se(){w(s=>s.concat({id:Date.now().toString(),table:"",field:"",resType:"",inputType:"",isOpen:!0}))}function W(){const s={...x,config:{...x.config,replaceJSONTypeFieldConfiguration:I,schemaExtension:O}};R.put("/dataSource",s)}function N(s){w(u=>u.filter(b=>b.id!==s.id))}return l("div",{className:"flex gap-6 h-[calc(100vh_-_190px)]",children:[l("div",{className:"w-2/5",children:[e("div",{className:`${be.head}`,children:e("span",{children:"\u81EA\u5B9A\u4E49\u7C7B\u578B"})}),e(Le,{language:"graphql",value:O,onChange:s=>X(s!=null?s:"")})]}),l("div",{className:"w-3/5",children:[l("div",{className:`${be.head} !pr-3 flex items-center justify-between`,children:[e("span",{children:"\u5B57\u6BB5\u7C7B\u578B\u6620\u5C04"}),l(G,{size:"small",className:`${be.btn} flex items-center justify-evenly cursor-pointer`,onClick:W,children:[e(k,{type:"icon-baocun",style:{color:"#5F6269"}}),e("span",{className:"text-sm",children:"\u4FDD\u5B58"})]})]}),l("div",{className:"relative py-3 px-3.5 bg-[#FFFFFF]",children:[e(Ge,{onClick:se,className:"absolute right-2 top-1 z-2 cursor-pointer !text-[#649FFF]"}),l("table",{className:"w-full bg-[#FFFFFFFF] disable-common-select",children:[e("thead",{className:"leading-38px bg-[#5F62690D]",children:l("tr",{className:"",children:[e("th",{children:"\u8868"}),e("th",{children:"\u5B57\u6BB5"}),e("th",{children:"\u54CD\u5E94\u7C7B\u578B"}),e("th",{children:"\u8F93\u5165\u7C7B\u578B"}),e("th",{children:"\u662F\u5426\u5F00\u542F"}),e("th",{})]})}),e("tbody",{children:I.map((s,u)=>l("tr",{onMouseEnter:()=>E(u),onMouseLeave:()=>E(null),className:`${f===u?"bg-[#F8F8F9FF]":""} h-45px`,children:[e("td",{children:e(j,{className:"disable-common-select",defaultValue:s.table,style:{width:120},bordered:!1,options:n,value:s.table,onChange:b=>H(b,s)})}),e("td",{children:e(j,{className:"disable-common-select",defaultValue:"",style:{width:120},bordered:!1,options:$(s),value:s.field,onChange:b=>P(b,s)})}),e("td",{children:e(j,{className:"disable-common-select",defaultValue:"",style:{width:120},bordered:!1,options:Y,value:s.resType,onChange:b=>ae(b,s)})}),e("td",{children:e(j,{className:"disable-common-select",defaultValue:"",style:{width:120},bordered:!1,options:c,value:s.inputType,onChange:b=>q(b,s)})}),e("td",{children:e(Fe,{className:"w-8 h-2",checked:s.isOpen,onChange:b=>K(b,s)})}),e("td",{children:e(k,{className:`cursor-pointer ${f===u?"visible":"invisible"}`,style:{color:"#F21212FF"},type:"icon-shanchu",onClick:()=>N(s)})})]},u))})]})]})]})]})},aa=ea,{Option:we}=j,la=/^(([0-9]|[1-9]\d{1,3}|[1-5]\d{4}|6[0-5]{2}[0-3][0-5]))$/,sa=/^[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(\.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+\.?$/,ta=/^((25[0-5])|(2[0-4]\d)|(1\d\d)|([1-9]\d)|\d)(\.((25[0-5])|(2[0-4]\d)|(1\d\d)|([1-9]\d)|\d)){3}$/,na="/static/upload/sqlite";function ua({content:a,type:F}){var J,V,ee,te,m;const x=fe(),{handleToggleDesigner:i,handleSave:I}=h.exports.useContext(ie),[w,D]=v(!1),[y,n]=v(!1),[B]=t.useForm(),c=a.config,[Q,Y]=v({}),[L,O]=v(!0),[X,f]=v([]),[E,$]=v(""),[H,P]=v(!1),q=c.dbType,ae=r=>{B.setFieldValue(["databaseUrl","val"],r),B.setFieldValue(["databaseUrl","kind"],"0")},K=r=>{var C,M;switch(r){case"0":O(!0),Y({pattern:/^\w{1,128}$/g,message:"\u8BF7\u8F93\u5165\u957F\u5EA6\u4E0D\u5927\u4E8E128\u7684\u975E\u7A7A\u503C"}),B.setFieldValue(["databaseUrl","val"],"");return;case"1":O(!1),$((M=(C=X.at(0))==null?void 0:C.label)!=null?M:""),B.setFieldValue(["databaseUrl","val"],"");return;default:O(!1);return}},se=r=>{$(r)};h.exports.useEffect(()=>{Ee("/env").then(r=>r.filter(C=>C.isDel===0).map(C=>({label:C.key,value:C.key}))).then(r=>f(r))},[]);const W=q==="SQLite"?e(t.Item,{rules:[{required:!0,message:"\u8BF7\u4E0A\u4F20\u6587\u4EF6"}],label:e(o,{children:e("span",{children:"\u8DEF\u5F84"})}),colon:!1,name:["databaseUrl","val"],style:{marginBottom:"20px"},children:e(A,{placeholder:"\u8BF7\u8F93\u5165...",onClick:()=>P(!0),suffix:e("a",{onClick:()=>P(!0),children:"\u6D4F\u89C8"}),readOnly:!0})}):e(t.Item,{label:"\u8FDE\u63A5URL",children:l(A.Group,{compact:!0,children:[e(t.Item,{name:["databaseUrl","kind"],noStyle:!0,children:l(j,{className:"w-1/5",onChange:K,children:[e(we,{value:"0",children:"\u503C"}),e(we,{value:"1",children:"\u73AF\u5883\u53D8\u91CF"})]})}),L?e(t.Item,{name:["databaseUrl","val"],noStyle:!0,rules:[Q],children:e(A,{style:{width:"80%"},placeholder:"\u8BF7\u8F93\u5165"})}):e(t.Item,{name:["databaseUrl","val"],noStyle:!0,rules:[Q],children:e(j,{className:"w-1/5",style:{width:"80%"},options:X,value:E,onChange:se})})]})}),N=l(o,{children:[e(t.Item,{label:"\u4E3B\u673A:",name:"host",rules:[{required:!0,message:"\u4E3B\u673A\u540D\u4E0D\u80FD\u4E3A\u7A7A"},{pattern:sa||ta,message:"\u8BF7\u586B\u5199\u89C4\u8303\u57DF\u540D\u6216\u8005ip"}],children:e(A,{placeholder:"\u8BF7\u8F93\u5165..."})}),e(t.Item,{label:"\u6570\u636E\u5E93\u540D:",name:"dbName",rules:[{required:!0,message:"\u6570\u636E\u5E93\u540D\u4E0D\u80FD\u4E3A\u7A7A"},{pattern:new RegExp("^[a-zA-Z_][a-zA-Z0-9_-]*$","g"),message:"\u4EE5\u5B57\u6BCD\u6216\u4E0B\u5212\u7EBF\u5F00\u5934\uFF0C\u53EA\u80FD\u7531\u6570\u5B57\u3001\u5B57\u6BCD\u3001\u4E0B\u5212\u7EBF\u7EC4\u6210"}],children:e(A,{placeholder:"\u8BF7\u8F93\u5165..."})}),e(t.Item,{label:"\u7AEF\u53E3:",name:"port",rules:[{required:!0,message:"\u7AEF\u53E3\u53F7\u4E0D\u80FD\u4E3A\u7A7A"},{pattern:la,message:"\u7AEF\u53E3\u8303\u56F4\u4E3A0-9999"}],children:e(A,{placeholder:"\u8BF7\u8F93\u5165..."})}),e(t.Item,{label:"\u7528\u6237:",name:"userName",rules:[{required:!0,message:"\u7528\u6237\u540D\u4E0D\u80FD\u4E3A\u7A7A"},{pattern:new RegExp("^[a-zA-Z_][a-zA-Z0-9_]*$","g"),message:"\u4EE5\u5B57\u6BCD\u6216\u4E0B\u5212\u7EBF\u5F00\u5934\uFF0C\u53EA\u80FD\u7531\u6570\u5B57\u3001\u5B57\u6BCD\u3001\u4E0B\u5212\u7EBF\u7EC4\u6210"}],children:e(A,{placeholder:"\u8BF7\u8F93\u5165..."})}),e(t.Item,{label:"\u5BC6\u7801:",name:"password",children:e(A.Password,{placeholder:"\u8BF7\u8F93\u5165..."})})]}),[s,u]=v(W);if(h.exports.useEffect(()=>{F==="form"&&B.resetFields(),u(c.appendType=="1"?N:W)},[a,F]),h.exports.useEffect(()=>{u(W)},[L]),!a)return e(Ce,{});const b=async r=>{const C={...c,...r};C.databaseUrl===void 0?C.databaseUrl={}:C.databaseUrl.kind===void 0&&(C.databaseUrl.kind="0");let M;if(a.name==""||a.name.startsWith("example_")){const Z={...a,config:C,name:r.apiNamespace};Reflect.deleteProperty(Z,"id");const re=await R.post("/dataSource",Z);a.id=re,M=a}else M={...a,config:C,name:r.apiNamespace},await R.put("/dataSource",M);I(M)},g=r=>{console.log("Failed:",r)},d=r=>{const C=B.getFieldsError().some(({errors:M})=>M.length);D(C)},_=r=>{R.post("/checkDBConn",{data:{sourceType:a.sourceType,config:c}}).then(C=>{C.msg==="\u8FDE\u63A5\u6210\u529F"?he.open({message:e(k,{type:"icon-bixu"}),description:e("h1",{children:"\u8FDE\u63A5\u6210\u529F"}),placement:r}):he.open({message:e(k,{type:"icon-xingzhuangjiehe"}),description:e("h1",{children:"\u8FDE\u63A5\u5931\u8D25"}),placement:r})})},z=r=>{switch(r){case"0":u(W);break;case"1":u(N);break;default:u("");break}};return l(o,{children:[e(ce,{className:Ne.modal,title:null,footer:null,open:H,onOk:()=>P(!1),onCancel:()=>P(!1),width:920,children:e(Be,{basePath:na,setUploadPath:ae,setVisible:P,upType:2})}),F==="detail"?l("div",{children:[e("div",{className:"py-10px flex justify-end",children:e("div",{className:"h-22px bg-[#F9F9F9] rounded-2px text-[#E92E5E] w-21 flex items-center justify-center cursor-pointer",onClick:()=>i("setting",a.id),children:"\u66F4\u591A\u8BBE\u7F6E"})}),e("div",{children:l(p,{bordered:!0,column:1,size:"small",children:[e(p.Item,{label:"\u8FDE\u63A5\u540D",children:c.apiNamespace}),e(p.Item,{label:"\u6570\u636E\u5E93\u7C7B\u578B",children:c.dbType}),q==="SQLite"?e(p.Item,{label:"\u8DEF\u5F84",children:(V=(J=c.databaseUrl)==null?void 0:J.val)!=null?V:""}):l(o,{children:[q==="MongoDB"?e(o,{}):e(p.Item,{label:"\u8FDE\u63A5\u7C7B\u578B",children:c.appendType=="0"?"\u8FDE\u63A5URL":c.appendType=="1"?"\u8FDE\u63A5\u53C2\u6570":""}),c.appendType=="1"?l(o,{children:[e(p.Item,{label:"\u4E3B\u673A",children:c.host}),e(p.Item,{label:"\u7AEF\u53E3",children:c.port}),e(p.Item,{label:"\u6570\u636E\u5E93\u540D",children:c.dbName}),e(p.Item,{label:"\u7528\u6237",children:c.userName}),e(p.Item,{label:"\u5BC6\u7801",children:y?l("span",{children:[c.password,e(k,{className:"ml-2",type:"icon-xiaoyanjing-chakan",onClick:()=>n(!y)})]}):l("span",{children:["**********",e(k,{className:"ml-2",type:"icon-xiaoyanjing-yincang",onClick:()=>n(!y)})]})})]}):e(o,{children:e(p.Item,{label:"\u8FDE\u63A5URL",children:(ee=c.databaseUrl)==null?void 0:ee.val})})]})]})})]}):F==="form"?e("div",{children:e("div",{className:`${Ne["form-contain"]} py-6 rounded-xl mb-4`,children:l(t,{form:B,style:{width:"90%"},name:"basic",labelCol:{span:4},wrapperCol:{span:12},onFinish:r=>void b(r),onFinishFailed:g,onValuesChange:d,validateTrigger:["onBlur","onChange"],autoComplete:"new-password",labelAlign:"right",initialValues:{apiNamespace:c.apiNamespace,dbType:c.dbType,appendType:c.appendType||"0",host:c.host,dbName:c.dbName,port:c.port,userName:c.userName,password:c.password,databaseUrl:{kind:((te=c.databaseUrl)==null?void 0:te.kind)||"0",val:(m=c.databaseUrl)==null?void 0:m.val}},children:[e(t.Item,{label:"\u540D\u79F0:",name:"apiNamespace",rules:[{required:!0,message:"\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"},{pattern:new RegExp("^[a-zA-Z_][a-zA-Z0-9_]*$","g"),message:"\u4EE5\u5B57\u6BCD\u6216\u4E0B\u5212\u7EBF\u5F00\u5934\uFF0C\u53EA\u80FD\u7531\u6570\u5B57\u3001\u5B57\u6BCD\u3001\u4E0B\u5212\u7EBF\u7EC4\u6210"}],children:e(A,{placeholder:"\u8BF7\u8F93\u5165...",autoComplete:"off",autoFocus:!0})}),q==="SQLite"||q==="MongoDB"?e(o,{}):e(t.Item,{label:"\u8FDE\u63A5\u7C7B\u578B:",name:"appendType",children:l(ne.Group,{onChange:r=>z(r.target.value),children:[e(ne,{value:"0",style:{marginRight:"50px"},children:"\u8FDE\u63A5URL"}),e(ne,{value:"1",children:" \u8FDE\u63A5\u53C2\u6570 "})]})}),s,l(t.Item,{wrapperCol:{offset:4,span:16},children:[e(G,{className:"btn-cancel",onClick:()=>{a.name?i("detail",a.id,a.sourceType):x("/workbench/dataSource/new")},children:e("span",{children:"\u53D6\u6D88"})}),e(G,{className:"btn-test ml-4",onClick:()=>_("bottomLeft"),children:"\u6D4B\u8BD5"}),e(G,{className:"btn-save ml-4",onClick:()=>{B.submit()},children:"\u4FDD\u5B58"})]})]})})}):e(aa,{content:a,initSchema:c.schemaExtension,replaceJSON:c.replaceJSONTypeFieldConfiguration})]})}const ia="_title_13oac_1",ra={title:ia},ca=[{name:"API",items:[{name:"REST API",logo:"icon-shujuyuantubiao3",sourceType:2},{name:"GraphQL API",logo:"icon-QLweixuanzhong1",sourceType:3}]},{name:"\u6570\u636E\u5E93",items:[{name:"PostgreSQL",logo:"icon-shujuyuantubiao2",sourceType:1,dbType:"PostgreSQL"},{name:"MySQL",logo:"icon-shujuyuantubiao1",sourceType:1,dbType:"MySQL"},{name:"MongoDB",logo:"icon-shujuyuantubiao4",sourceType:1,dbType:"MongoDB"},{name:"Sqlite",logo:"icon-shujuyuantubiao3",sourceType:1,dbType:"SQLite"}]},{name:"\u81EA\u5B9A\u4E49",items:[{name:"\u81EA\u5B9A\u4E49",logo:"icon-wenjian",sourceType:4}]}];function oa(){h.exports.useContext(Ie);const{handleToggleDesigner:a,handleCreate:F}=h.exports.useContext(ie),[x,i]=h.exports.useState(ca),[I,w]=h.exports.useState([]);h.exports.useEffect(()=>{R.get("/dataSource/example").then(y=>(w(y.map(n=>n.config)),y)).then(y=>y.map(n=>({name:n.config.name,logo:"icon-QLweixuanzhong1",sourceType:n.config.sourceType,dbType:n.config.config.dbType}))).then(y=>{i(n=>n.concat({name:"\u793A\u4F8B\u6570\u636E\u6E90",items:y}))})},[]);function D(y,n,B){let c={id:Date.now(),name:"",config:{dbType:n},sourceType:y,switch:0};B.startsWith("example_")&&(c=I.find(Q=>Q.name===B)),c.id=Date.now(),F(c)}return e(o,{children:x.map(y=>l("div",{className:"mb-12",children:[e("div",{className:`text-lg ${ra.title}`,children:e("span",{className:"pl-2.5",children:y.name})}),e("div",{className:"flex flex-wrap my-4 gap-x-9.5 gap-y-5 items-center",children:y.items.map(n=>l("div",{className:"border rounded cursor-pointer bg-[#F8F9FD] border-gray-300/20 min-w-53 py-3.5 pl-4 transition-shadow text-[#333333] w-53 hover:shadow-lg",onClick:()=>D(n.sourceType,n.dbType,n.name),children:[e("div",{className:"bg-white rounded-3xl h-7 shadow w-7 inline-flex items-center justify-center",children:e(k,{type:n.logo,style:{fontSize:"16px"}})}),e("span",{className:"ml-3",children:n.name})]},n.name))})]},y.name))})}const da=a=>e("div",{style:{width:0,position:"relative",left:"5px",height:"100%",display:"inline-block",verticalAlign:"middle",fontSize:0},children:e(qe,{title:a.title,arrowPointAtCenter:!0,children:e("div",{style:{position:"absolute",top:"50%",transform:"translateY(-50%)",fontSize:0,maxWidth:"initial"},children:e(le,{width:10,height:10,alt:"\u63D0\u793A",preview:!1,src:"/assets/warning.png"})})})}),S=da,ma="_modal_1y1rp_56",T={"edit-btn":"_edit-btn_1y1rp_1","switch-check-btn":"_switch-check-btn_1y1rp_20","descriptions-box":"_descriptions-box_1y1rp_26","collapse-box":"_collapse-box_1y1rp_29","form-icon":"_form-icon_1y1rp_35","label-style":"_label-style_1y1rp_39","connect-check-btn-common":"_connect-check-btn-common_1y1rp_43","table-contain":"_table-contain_1y1rp_53",modal:ma},oe=a=>e(le,{width:14,height:14,preview:!1,alt:"\u8BF7\u6C42\u5934\u7C7B\u578B",src:{0:"/assets/header-value.png",1:"/assets/header-env.png",2:"/assets/header-relay.png"}[a]}),ha="/static/upload/oas";function pa({content:a,type:F}){var g;const x=fe(),i=a.config,{handleSave:I,handleToggleDesigner:w}=h.exports.useContext(ie);v({});const[D,y]=v({});v(!1);const[n,B]=v(i.loadSchemaFromString!==void 0),[c,Q]=v(!1),[Y,L]=v(!0),[O,X]=v([]),[f,E]=v(""),[$,H]=v(!1),[P]=t.useForm(),{Option:q}=j,{Panel:ae}=ue,K=/^https?:\/\/[-.\w\d:/]+$/i;h.exports.useEffect(()=>{B(i.loadSchemaFromString!==void 0)},[F]),h.exports.useEffect(()=>{P.resetFields()},[a,F]),h.exports.useEffect(()=>{Ee("/env").then(d=>d.filter(_=>_.isDel===0).map(_=>({label:_.key,value:_.key}))).then(d=>X(d))},[]);const se=async d=>{var J;d.headers=(J=d.headers)==null?void 0:J.filter(V=>V.key!=null);const _={...d};let z;if(a.name===""||a.id.toString().length>10){const V={...a,config:_,name:d.apiNameSpace};Reflect.deleteProperty(V,"id");const ee=await R.post("/dataSource",V);a.id=ee,z=a}else z={...a,config:_,name:d.apiNameSpace},await R.put("/dataSource",z);I(z)},W=d=>{console.log("Failed:",d)},N=d=>{switch(d){case"0":L(!0),y({pattern:/^[/\w]{1,128}$/g,message:"\u8BF7\u8F93\u5165\u957F\u5EA6\u4E0D\u5927\u4E8E128\u7684\u975E\u7A7A\u503C"});return;case"1":L(!1);return;case"2":L(!0),y({pattern:/^\w+$/g,message:"\u8BF7\u8F93\u5165\u975E\u7A7A\u503C"});return;default:return}},s=[],u=d=>{y({type:"array",validator(_,z){if(!!z)return z.every(J=>J.match(/^[a-zA-Z_][a-zA-Z0-9_]*$/g))?Promise.resolve():Promise.reject("\u4EE5\u5B57\u6BCD\u6216\u4E0B\u5212\u7EBF\u5F00\u5934\uFF0C\u53EA\u80FD\u7531\u5B57\u6BCD\u3001\u4E0B\u5212\u7EBF\u548C\u6570\u5B57\u7EC4\u6210")}})},b=d=>{P.setFieldValue("loadSchemaFromString",d)};return a?l(o,{children:[F==="detail"?l(o,{children:[e("div",{className:"flex justify-center mb-8",children:l(p,{bordered:!0,column:1,size:"small",labelStyle:{width:190},children:[e(p.Item,{label:e("div",{children:l("span",{className:T["label-style"],children:["\u540D\u79F0",e(S,{title:"\u540D\u79F0"})]})}),className:"justify-start",children:i.apiNameSpace}),e(p.Item,{label:e("div",{children:l("span",{className:T["label-style"],children:["Graphql \u7AEF\u70B9",e(S,{title:"Graphql \u7AEF\u70B9"})]})}),className:"justify-start",children:i.url}),i!=null&&i.loadSchemaFromString?l(p.Item,{label:e("div",{children:l("span",{className:T["label-style"],children:["\u6307\u5B9ASchema",e(S,{title:"\u6307\u5B9ASchema"})]})}),className:"justify-start",children:[e(k,{type:"icon-wenjian1"})," ",i.loadSchemaFromString]}):""]})}),e("div",{className:"text-base font-medium ml-3 mb-3",children:"\u8BF7\u6C42\u5934"}),e("div",{className:`${T["table-contain"]} mb-8`,children:e(p,{bordered:!0,column:1,size:"small",labelStyle:{width:190},children:((g=i==null?void 0:i.headers)!=null?g:[]).map(({key:d="",kind:_="",val:z=""})=>e(p.Item,{label:e("div",{children:l("span",{className:T["label-style"],children:[d,e(S,{title:"test"})]})}),className:"justify-start",style:{wordBreak:"break-all"},children:l("div",{className:"flex items-center",children:[e("div",{className:"text-0px",children:oe(_)}),e("div",{className:"flex-1 min-w-0 ml-2",children:z})]})},d))})}),e(ue,{ghost:!0,bordered:!1,defaultActiveKey:["1"],expandIcon:({isActive:d})=>e(k,{type:"icon-xiala",rotate:d?0:-90}),className:`${T["collapse-box"]} site-collapse-custom-collapse bg-light-50`,children:e(ae,{header:"\u66F4\u591A\u8BBE\u7F6E",className:"site-collapse-custom-panel",children:e("div",{className:"flex justify-center mb-8",children:l(p,{bordered:!0,column:1,size:"small",labelStyle:{width:190},children:[e(p.Item,{label:e("div",{children:l("span",{className:T["label-style"],children:["\u662F\u5426\u5185\u90E8",e(S,{title:"\u662F\u5426\u5185\u90E8"})]})}),className:"justify-start",children:i.internal?e(pe,{color:"green",children:"\u5F00\u542F"}):e(pe,{color:"red",children:"\u5173\u95ED"})}),e(p.Item,{label:e("div",{children:l("span",{className:T["label-style"],children:["\u81EA\u5B9A\u4E49Float\u6807\u91CF",e(S,{title:"\u81EA\u5B9A\u4E49Float\u6807\u91CF"})]})}),className:"justify-start",children:i.customFloatScalars}),e(p.Item,{label:e("div",{children:l("span",{className:T["label-style"],children:["\u81EA\u5B9A\u4E49INT\u6807\u91CF",e(S,{title:"\u81EA\u5B9A\u4E49INT\u6807\u91CF"})]})}),className:"justify-start",children:i.customIntScalars}),e(p.Item,{label:e("div",{children:l("span",{className:T["label-style"],children:["\u6392\u9664\u91CD\u547D\u540D\u6839\u5B57\u6BB5",e(S,{title:"\u6392\u9664\u91CD\u547D\u540D\u6839\u5B57\u6BB5"})]})}),className:"justify-start",children:i.skipRenameRootFields})]})})},"1")})]}):l(o,{children:[e("div",{className:"pb-9px flex items-center justify-between border-gray border-b",children:a.name==""?l("div",{children:[e(k,{type:"icon-QLweixuanzhong1"}),e("span",{className:"ml-2",children:"\u521B\u5EFA\u6570\u636E\u6E90"})]}):l("div",{children:[e(k,{type:"icon-QLweixuanzhong1"}),l("span",{className:"ml-2",children:[a.name," ",e("span",{className:"text-xs text-gray-500/80",children:"GET"})]})]})}),l("div",{className:"py-6 rounded-xl mb-4",children:[l(t,{form:P,name:"basic",labelCol:{span:4},wrapperCol:{span:10},onFinish:d=>void se(d),onFinishFailed:W,autoComplete:"off",validateTrigger:["onBlur","onChange"],className:"ml-3",labelAlign:"right",initialValues:{apiNameSpace:i.apiNameSpace,url:i.url,loadSchemaFromString:i.loadSchemaFromString,internal:i.internal,customFloatScalars:i.customFloatScalars,customIntScalars:i.customIntScalars,skipRenameRootFields:i.skipRenameRootFields,headers:i.headers||[],agreement:i.loadSchemaFromString!==void 0},children:[e(t.Item,{label:e("div",{children:l("span",{className:T["label-style"],children:["\u540D\u79F0:",e(S,{title:"\u540D\u79F0"})]})}),colon:!1,style:{marginBottom:"20px"},name:"apiNameSpace",rules:[{required:!0,message:"\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"},{pattern:/^[a-zA-Z_][a-zA-Z0-9_]*$/g,message:"\u4EE5\u5B57\u6BCD\u6216\u4E0B\u5212\u7EBF\u5F00\u5934\uFF0C\u53EA\u80FD\u7531\u6570\u5B57\u3001\u5B57\u6BCD\u3001\u4E0B\u5212\u7EBF\u7EC4\u6210"}],children:e(A,{placeholder:"\u8BF7\u8F93\u5165..."})}),e(t.Item,{label:e("div",{children:l("span",{className:T["label-style"],children:["Graphql \u7AEF\u70B9:",e(S,{title:"Graphql \u7AEF\u70B9"})]})}),colon:!1,required:!0,rules:[{required:!0,message:"\u7AEF\u70B9\u4E0D\u80FD\u4E3A\u7A7A"},{pattern:K,message:"\u8BF7\u586B\u5199\u89C4\u8303\u57DF\u540D"}],style:{marginBottom:"20px"},name:"url",children:e(A,{placeholder:"\u8BF7\u8F93\u5165..."})}),e(t.Item,{name:"agreement",label:" ",valuePropName:"checked",children:e(Oe,{onChange:()=>{B(!n)},children:"\u901A\u8FC7\u53D1\u9001\u6307\u4EE4,\u81EA\u52A8\u5185\u7701Schema"})}),n?e(t.Item,{label:e("div",{children:l("span",{className:T["label-style"],children:["\u6307\u5B9ASchema:",e(S,{title:"\u6307\u5B9ASchema"})]})}),colon:!1,name:"loadSchemaFromString",required:!0,style:{marginBottom:"48px"},children:e(A,{placeholder:"\u8BF7\u8F93\u5165...",onClick:()=>H(!0),suffix:e("a",{onClick:()=>H(!0),children:"\u6D4F\u89C8"}),readOnly:!0})}):"",e("div",{className:"text-lg ml-3 mb-3",children:"\u8BF7\u6C42\u5934:"}),e(t.Item,{wrapperCol:{span:24},children:e(t.List,{name:"headers",children:(d,{add:_,remove:z},{errors:J})=>l(o,{children:[d.map((V,ee)=>l(Se,{align:"baseline",style:{display:"flex"},children:[e(t.Item,{className:"w-52.5",name:[V.name,"key"],children:e(A,{})}),e(t.Item,{className:"w-40",name:[V.name,"kind"],children:l(j,{onChange:N,children:[l(q,{value:"0",children:[e("span",{className:"mr-1 inline-flex align-top h-full items-center",children:oe("0")}),"\u503C"]}),l(q,{value:"1",children:[e("span",{className:"mr-1 inline-flex align-top h-full items-center",children:oe("1")}),"\u73AF\u5883\u53D8\u91CF"]}),l(q,{value:"2",children:[e("span",{className:"mr-1 inline-flex align-top h-full items-center",children:oe("2")}),"\u8F6C\u53D1\u81EA\u5BA2\u6237\u7AEF"]})]})}),e(t.Item,{className:"w-135 flex-0",name:[V.name,"val"],rules:P.getFieldValue(["headers",V.name,"kind"])==="0"?[{pattern:/^[/\w]{1,128}$/g,message:"\u8BF7\u8F93\u5165\u957F\u5EA6\u4E0D\u5927\u4E8E128\u7684\u975E\u7A7A\u503C"}]:[],children:P.getFieldValue(["headers",V.name,"kind"])==="0"?e(A,{placeholder:"\u8BF7\u8F93\u5165"}):e(j,{className:"w-1/5",style:{width:"80%"},options:O,value:f,onChange:te=>E(te)})}),e(le,{alt:"\u6E05\u9664",width:14,height:14,preview:!1,src:"/assets/clear.png",className:"cursor-pointer",onClick:()=>z(ee)})]},V.key)),l(t.Item,{wrapperCol:{span:16},children:[e(G,{type:"dashed",onClick:()=>{L(!0),_({kind:"0"})},icon:e(ke,{}),className:"text-gray-500/60 w-1/1",children:"\u65B0\u589E\u8BF7\u6C42\u5934\u4FE1\u606F"}),e(t.ErrorList,{errors:J})]})]})})}),e(ue,{ghost:!0,bordered:!1,defaultActiveKey:["0"],expandIcon:({isActive:d})=>e(ge,{rotate:d?90:0}),className:`${T["collapse-box"]} site-collapse-custom-collapse bg-white-50`,children:l(ae,{header:"\u66F4\u591A\u8BBE\u7F6E",className:"site-collapse-custom-panel",children:[e(t.Item,{label:e("div",{children:l("span",{className:T["label-style"],children:["\u662F\u5426\u5185\u90E8",e(S,{title:"\u662F\u5426\u5185\u90E8"})]})}),valuePropName:"checked",name:"internal",colon:!1,style:{marginBottom:"20px"},children:e(Fe,{className:T["switch-edit-btn"],size:"small"})}),e(t.Item,{label:e("div",{className:"",children:l("span",{className:T["label-style"],children:["\u81EA\u5B9A\u4E49Float\u6807\u91CF",e(S,{title:"\u81EA\u5B9A\u4E49Float\u6807\u91CF"})]})}),name:"customFloatScalars",rules:[D],colon:!1,style:{marginBottom:"20px"},children:e(j,{mode:"tags",style:{width:"100%"},placeholder:"Tags Mode",onChange:u,children:s})}),e(t.Item,{label:e("div",{children:l("span",{className:T["label-style"],children:["\u81EA\u5B9A\u4E49INT\u6807\u91CF",e(S,{title:"\u81EA\u5B9A\u4E49INT\u6807\u91CF"})]})}),name:"customIntScalars",rules:[D],colon:!1,style:{marginBottom:"20px"},children:e(j,{mode:"tags",style:{width:"100%"},placeholder:"Tags Mode",onChange:u,children:s})}),e(t.Item,{label:e("div",{children:l("span",{className:T["label-style"],children:["\u6392\u9664\u91CD\u547D\u540D\u6839\u5B57\u6BB5",e(S,{title:"\u6392\u9664\u91CD\u547D\u540D\u6839\u5B57\u6BB5"})]})}),colon:!1,style:{marginBottom:"20px"},name:"skipRenameRootFields",rules:[D],children:e(j,{mode:"tags",style:{width:"100%"},placeholder:"Tags Mode",onChange:u,children:s})})]},"1")})]}),l("div",{className:"flex justify-center items-center w-40 mt-5",children:[e(G,{className:"btn-save ml-4",onClick:()=>{P.submit()},children:a.name==""?"\u521B\u5EFA":"\u4FDD\u5B58"}),e(G,{className:"btn-cancel ml-4",onClick:()=>{a.name?w("detail",a.id,a.sourceType):x("/workbench/dataSource/new")},children:e("span",{children:"\u53D6\u6D88"})})]})]})]}),e(ce,{className:T.modal,title:null,footer:null,open:$,onOk:()=>H(!1),onCancel:()=>H(!1),width:920,children:e(Be,{basePath:ha,setUploadPath:b,setVisible:H,upType:1})}),e(ce,{title:"GraphiQL",open:c,onOk:()=>Q(!1),onCancel:()=>Q(!1),footer:null,centered:!0,bodyStyle:{height:"90vh"},width:"90vw"})]}):e(Ce,{})}const fa="_modal_4l36t_42",U={"switch-check-btn":"_switch-check-btn_4l36t_1","switch-edit-btn":"_switch-edit-btn_4l36t_7","form-icon":"_form-icon_4l36t_13","connect-check-btn-common":"_connect-check-btn-common_4l36t_17","table-contain":"_table-contain_4l36t_27","redoc-container":"_redoc-container_4l36t_30",modal:fa},de=a=>e(le,{width:14,height:14,preview:!1,alt:"\u8BF7\u6C42\u5934\u7C7B\u578B",src:{0:"/assets/header-value.png",1:"/assets/header-env.png",2:"/assets/header-relay.png"}[a]}),Fa="/static/upload/oas",{TabPane:Ae}=ye;function ba({content:a,type:F}){var V,ee,te;const x=fe(),{handleToggleDesigner:i,handleSave:I}=h.exports.useContext(ie),[w]=t.useForm(),[D,y]=v(!1),[n,B]=v(!1),[c,Q]=v(1),[Y,L]=v({}),[O,X]=v(!0),[f,E]=v(!0),[$,H]=v([]),[P,q]=v(""),[ae,K]=v(!1),se=m=>{w.setFieldValue("filePath",m),w.validateFields(["filePath"])};h.exports.useEffect(()=>{w.resetFields()},[a,F]),h.exports.useEffect(()=>{Ee("/env").then(m=>m.filter(r=>r.isDel===0).map(r=>({label:r.key,value:r.key}))).then(m=>H(m))},[]);const W=m=>{q(m)};if(!a)return e(Ce,{});const N=a.config,s=()=>{y(!D)},u=m=>{var r,C;switch(m){case"0":E(!0),L({pattern:/^[/\w]{1,128}$/g,message:"\u8BF7\u8F93\u5165\u957F\u5EA6\u4E0D\u5927\u4E8E128\u7684\u975E\u7A7A\u503C"});return;case"1":E(!1),q((C=(r=$.at(0))==null?void 0:r.label)!=null?C:"");return;case"2":E(!0),L({pattern:/^[a-zA-Z_][a-zA-Z0-9_]*$/g,message:"\u4EE5\u5B57\u6BCD\u6216\u4E0B\u5212\u7EBF\u5F00\u5934\uFF0C\u53EA\u80FD\u7531\u5B57\u6BCD\u3001\u4E0B\u5212\u7EBF\u548C\u6570\u5B57\u7EC4\u6210"});return;default:return}},b=async m=>{var M;m.headers=(M=m.headers)==null?void 0:M.filter(Z=>Z.key!=null);const r={...m};let C;if(a.name==""||a.name.startsWith("example_")){const Z={...a,config:r,name:m.apiNameSpace};Reflect.deleteProperty(Z,"id");const re=await R.post("/dataSource",Z);a.id=re,C=a}else C={...a,config:r,name:m.apiNameSpace},await R.put("/dataSource",C);I(C)},g=m=>{throw me.error("\u63D0\u4EA4\u5931\u8D25!"),m},d=m=>{Q(m.target.value),X(!O)},{Option:_}=j,{Panel:z}=ue,J=m=>{m==="1"&&(E(!0),L({pattern:/^[/\w]{1,128}$/g,message:"\u8BF7\u8F93\u5165\u957F\u5EA6\u4E0D\u5927\u4E8E128\u7684\u975E\u7A7A\u503C"}))};return l(o,{children:[e(ce,{className:U.modal,title:null,footer:null,open:ae,onOk:()=>K(!1),onCancel:()=>K(!1),width:920,children:e(Be,{basePath:Fa,setUploadPath:se,setVisible:K,upType:1,beforeUpload:m=>{const r=m.name.endsWith(".json")||m.name.endsWith(".yaml")||m.name.endsWith(".yml");return r||me.error("\u53EA\u5141\u8BB8\u4E0A\u4F20 json \u6216 yaml \u683C\u5F0F\u6587\u4EF6"),r||xe.LIST_IGNORE}})}),F==="detail"?l(o,{children:[e("div",{className:"flex mb-8 justify-center",children:l(p,{bordered:!0,column:1,size:"small",className:U["descriptions-box"],children:[e(p.Item,{label:e(o,{children:l("span",{className:U["label-style"],children:["\u540D\u79F0 ",e(S,{title:"\u540D\u79F0"})]})}),className:"justify-start",children:N.apiNameSpace}),e(p.Item,{label:e(o,{children:l("span",{className:U["label-style"],children:["Rest \u7AEF\u70B9",e(S,{title:"Rest \u7AEF\u70B9"})]})}),className:"justify-start",children:N.baseURL}),e(p.Item,{label:e(o,{children:l("span",{className:U["label-style"],children:["\u6307\u5B9A OAS",e(S,{title:"\u6307\u5B9AOAS"})]})}),children:l("div",{className:"flex items-center",children:[e(le,{src:"/assets/upload-file.png",width:14,height:14,alt:"\u6587\u4EF6",preview:!1}),e("span",{className:"ml-2 text-11px text-[#909399]",children:N.filePath})]})})]})}),e("div",{className:"tabs-form",children:e(ye,{defaultActiveKey:"1",items:[{key:"1",label:"\u8BF7\u6C42\u5934",children:e(p,{className:"mb-8",bordered:!0,column:1,size:"small",labelStyle:{width:190},children:((V=N==null?void 0:N.headers)!=null?V:[]).map(({key:m="",kind:r="",val:C=""})=>e(p.Item,{label:e("div",{children:l("span",{className:U["label-style"],children:[m,e(S,{title:m})]})}),className:"justify-start",style:{wordBreak:"break-all"},children:l("div",{className:"flex items-center",children:[e("div",{className:"text-0px",children:de(r)}),e("div",{className:"flex-1 ml-2 min-w-0",children:C})]})},m))})},{key:"2",label:l("span",{className:U["label-style"],children:["\u6388\u6743",e(S,{title:"\u6388\u6743"})]}),children:e("div",{className:"flex mb-11 justify-center",children:l(p,{bordered:!0,column:1,size:"small",className:U["descriptions-box"],children:[e(p.Item,{label:"JWT\u83B7\u53D6",children:N.jwtType==1?"\u52A8\u6001":"\u9759\u6001"}),e(p.Item,{label:"\u5BC6\u94A5",children:D?l(o,{children:[e("span",{className:"mr-5",children:(ee=N.secret)==null?void 0:ee.val}),e(k,{type:"icon-xiaoyanjing-chakan",onClick:s})]}):l(o,{children:[e("span",{className:"mr-5",children:"********"}),e(k,{type:"icon-xiaoyanjing-yincang",onClick:s})]})}),e(p.Item,{label:"\u7B7E\u540D\u65B9\u6CD5",children:N.signingMethod}),e(p.Item,{label:"Token\u7AEF\u70B9",children:N.tokenPoint})]})})}]})}),e(ue,{ghost:!0,bordered:!1,defaultActiveKey:["0"],expandIcon:({isActive:m})=>e(ge,{rotate:m?90:0}),className:`${U["collapse-box"]} site-collapse-custom-collapse bg-white-50`,children:e(z,{header:"\u66F4\u591A\u8BBE\u7F6E",className:"site-collapse-custom-panel",children:e(p,{bordered:!0,column:1,size:"small",children:e(p.Item,{label:e("span",{className:U["label-style"],children:"\u662F\u5426\u72B6\u6001\u8054\u5408"}),className:"justify-start",children:N.statusCodeUnions?e(pe,{color:"green",children:"\u5F00\u542F"}):e(pe,{color:"red",children:"\u5173\u95ED"})})})},"1")}),e(ce,{centered:!0,open:n,onCancel:()=>B(!1),destroyOnClose:!0,width:"80%",bodyStyle:{height:"885px",overflow:"auto"},footer:null,children:e("div",{className:U["redoc-container"],children:n&&N.filePath&&e("iframe",{title:"rapi",src:`/#/rapi-frame?url=/upload/oas/${(te=N.filePath)!=null?te:""}`,width:"100%",height:"100%",className:"border-none"})})})]}):l(o,{children:[e("div",{className:"border-gray border-b flex pb-9px items-center justify-between",children:a.name==""?l(o,{children:[e(k,{type:"icon-shujuyuantubiao3"}),e("span",{className:"ml-2",children:"\u521B\u5EFA\u6570\u636E\u6E90"})]}):l(o,{children:[e(k,{type:"icon-shujuyuantubiao3"}),l("span",{className:"ml-2",children:[a.name," ",e("span",{className:"text-xs text-gray-500/80",children:"GET"})]})]})}),e("div",{className:"rounded-xl mb-4 py-6",children:l(t,{form:w,name:"basic",labelCol:{span:3},wrapperCol:{span:11},onFinish:m=>b(m),onFinishFailed:g,autoComplete:"off",validateTrigger:["onBlur","onChange"],labelAlign:"right",className:"ml-3",initialValues:{apiNameSpace:N.apiNameSpace,baseURL:N.baseURL,headers:N.headers||[],statusCodeUnions:N.statusCodeUnions,secret:N.secret||{kind:"0"},filePath:N.filePath||"",tokenPoint:N.tokenPoint,jwtType:N.jwtType},children:[e(t.Item,{label:l(o,{children:[e("span",{children:"\u547D\u540D\u7A7A\u95F4"}),e(S,{title:"\u547D\u540D\u7A7A\u95F4"})]}),rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u547D\u540D\u7A7A\u95F4"},{pattern:/^[a-zA-Z_][a-zA-Z0-9_]*$/g,message:"\u4EE5\u5B57\u6BCD\u6216\u4E0B\u5212\u7EBF\u5F00\u5934\uFF0C\u53EA\u80FD\u7531\u5B57\u6BCD\u3001\u4E0B\u5212\u7EBF\u548C\u6570\u5B57\u7EC4\u6210"}],name:"apiNameSpace",colon:!1,style:{marginBottom:"20px"},children:e(A,{placeholder:"\u8BF7\u8F93\u5165..."})}),e(t.Item,{label:l(o,{children:[e("span",{children:"Rest \u7AEF\u70B9"}),e(S,{title:"Rest \u7AEF\u70B9"})]}),rules:[{pattern:/^https?:\/\/[:.\w\d/]+$/g,message:"\u53EA\u5141\u8BB8\u8F93\u5165\u94FE\u63A5"}],name:"baseURL",colon:!1,style:{marginBottom:"20px"},children:e(A,{placeholder:"\u8BF7\u8F93\u5165..."})}),e(t.Item,{rules:[{required:!0,message:"\u8BF7\u4E0A\u4F20 OAS \u6587\u4EF6"}],label:l(o,{children:[e("span",{children:"\u6307\u5B9A OAS"}),e(S,{title:"\u6307\u5B9AOAS"})]}),colon:!1,name:"filePath",style:{marginBottom:"20px"},children:e(A,{placeholder:"\u8BF7\u8F93\u5165...",onClick:()=>K(!0),suffix:e("a",{onClick:()=>K(!0),children:"\u6D4F\u89C8"}),readOnly:!0})}),e("div",{className:"tabs-form",children:l(ye,{defaultActiveKey:"1",className:"ml-3",onChange:J,children:[e(Ae,{tab:"\u8BF7\u6C42\u5934",children:e(t.Item,{wrapperCol:{xs:{span:24},sm:{span:24}},children:e(t.List,{name:"headers",children:(m,{add:r,remove:C},{errors:M})=>l(o,{children:[m.map((Z,re)=>l(Se,{align:"baseline",children:[e(t.Item,{className:"w-52.5",wrapperCol:{span:24},name:[Z.name,"key"],children:e(A,{})}),e(t.Item,{className:"w-40",wrapperCol:{span:24},name:[Z.name,"kind"],children:l(j,{onChange:u,children:[l(_,{value:"0",children:[e("span",{className:"h-full mr-1 inline-flex align-top items-center",children:de("0")}),"\u503C"]}),l(_,{value:"1",children:[e("span",{className:"h-full mr-1 inline-flex align-top items-center",children:de("1")}),"\u73AF\u5883\u53D8\u91CF"]}),l(_,{value:"2",children:[e("span",{className:"h-full mr-1 inline-flex align-top items-center",children:de("2")}),"\u8F6C\u53D1\u81EA\u5BA2\u6237\u7AEF"]})]})}),e(t.Item,{className:"w-135",wrapperCol:{span:24},name:[Z.name,"val"],rules:w.getFieldValue(["headers",Z.name,"kind"])==="0"?[{pattern:/^[/\w]{1,128}$/g,message:"\u8BF7\u8F93\u5165\u957F\u5EA6\u4E0D\u5927\u4E8E128\u7684\u975E\u7A7A\u503C"}]:[],children:w.getFieldValue(["headers",Z.name,"kind"])==="0"?e(A,{style:{width:"80%"},placeholder:"\u8BF7\u8F93\u5165"}):e(j,{className:"w-1/5",style:{width:"80%"},options:$,value:P,onChange:W})}),e(k,{type:"icon-guanbi",onClick:()=>C(re)})]},Z.key)),l(t.Item,{wrapperCol:{span:16},children:[e(G,{type:"dashed",onClick:()=>{E(!0),r({kind:"0"})},icon:e(ke,{}),className:"text-gray-500/60 w-1/1",children:"\u65B0\u589E\u8BF7\u6C42\u5934\u4FE1\u606F"}),e(t.ErrorList,{errors:M})]})]})})})},"1"),l(Ae,{tab:l("div",{children:[e("span",{children:"\u6388\u6743"}),e(k,{type:"icon-wenhao",className:`${U["form-icon"]} ml-1`})]}),children:[e(t.Item,{label:"JWT\u83B7\u53D6",name:"jwtType",initialValue:"0",children:l(ne.Group,{onChange:d,value:c,children:[e(ne,{value:"0",className:"mr-20",children:"\u9759\u6001"}),e(ne,{value:"1",children:"\u52A8\u6001"})]})}),O?l(o,{children:[e(t.Item,{label:"\u5BC6\u94A5",children:l(A.Group,{compact:!0,children:[e(t.Item,{name:["secret","kind"],noStyle:!0,children:l(j,{className:"w-1/5",onChange:u,children:[e(_,{value:"0",children:"\u503C"}),e(_,{value:"1",children:"\u73AF\u5883\u53D8\u91CF"})]})}),f?e(t.Item,{name:["secret","val"],noStyle:!0,rules:[Y],children:e(A,{style:{width:"80%"},placeholder:"\u8BF7\u8F93\u5165"})}):e(t.Item,{name:["secret","val"],noStyle:!0,rules:[Y],children:e(j,{className:"w-1/5",style:{width:"80%"},options:$,value:P,onChange:W})})]})}),e(t.Item,{label:"\u7B7E\u540D\u65B9\u6CD5",name:"signingMethod",initialValue:"HS256",children:e(ne,{value:"HS256",checked:!0,children:"HS256"})})]}):l(o,{children:[e(t.Item,{label:"\u5BC6\u94A5",children:l(A.Group,{compact:!0,children:[e(t.Item,{name:["secret","kind"],noStyle:!0,children:l(j,{className:"w-1/5",onChange:u,children:[e(_,{value:"0",children:"\u503C"}),e(_,{value:"1",children:"\u73AF\u5883\u53D8\u91CF"})]})}),e(t.Item,{name:["secret","val"],noStyle:!0,rules:[Y],children:f?e(A,{style:{width:"80%"},placeholder:"\u8BF7\u8F93\u5165"}):e(j,{className:"w-1/5",style:{width:"80%"},options:$,value:P,onChange:W})})]})}),e(t.Item,{label:l(o,{children:[e("span",{children:"Token \u7AEF\u70B9"}),e(k,{type:"icon-wenhao",className:`${U["form-icon"]} ml-1`})]}),colon:!1,required:!0,style:{marginBottom:"20px"},name:"tokenPoint",children:e(A,{placeholder:"\u8BF7\u8F93\u5165..."})})]})]},"2")]})}),e(ue,{ghost:!0,bordered:!1,defaultActiveKey:["0"],expandIcon:({isActive:m})=>e(ge,{rotate:m?90:0}),children:e(z,{header:"\u66F4\u591A",className:"site-collapse-custom-panel",children:e(t.Item,{label:e(o,{children:l("span",{className:U["label-style"],children:["\u662F\u5426\u72B6\u6001\u8054\u5408",e(S,{title:"\u662F\u5426\u72B6\u6001\u8054\u5408"})]})}),name:"statusCodeUnions",colon:!1,style:{marginBottom:0},valuePropName:"checked",children:e(Fe,{className:U["switch-edit-btn"],size:"small"})})},"1")}),l("div",{className:"flex mt-10 w-160px justify-center items-center",children:[e(G,{className:"btn-save ml-4",onClick:()=>w.submit(),children:a.name==""?"\u521B\u5EFA":"\u4FDD\u5B58"}),e(G,{className:"btn-cancel  ml-4",onClick:()=>{a.name?i("detail",a.id,a.sourceType):x("/workbench/dataSource/new")},children:e("span",{children:"\u53D6\u6D88"})})]})]})})]})]})}function ul({content:a,showType:F}){const{handleToggleDesigner:x}=h.exports.useContext(ie),{onRefreshMenu:i}=h.exports.useContext($e),I=fe();if(!a)return e("div",{className:"h-full p-3 pb-0",children:e("div",{className:"bg-white h-full pt-5.5 pl-5.5 overflow-auto",children:e(oa,{})})});const w=async()=>{!a||(a.switch^=1,a&&await R.put("/dataSource",a),i("dataSource"))};let D="other";switch(a==null?void 0:a.sourceType){case 1:D=String(a.config.dbType)||D;break;case 2:D="rest";break;case 3:D="graphql";break}const y=n=>{a.sourceType===1?R.post("/checkDBConn",{data:{sourceType:a.sourceType,config:a.config}}).then(B=>{B.msg==="\u8FDE\u63A5\u6210\u529F"?he.open({message:e(k,{type:"icon-bixu"}),description:e("h1",{children:"\u8FDE\u63A5\u6210\u529F"}),placement:n}):he.open({message:e(k,{type:"icon-xingzhuangjiehe"}),description:e("h1",{children:"\u8FDE\u63A5\u5931\u8D25"}),placement:n})}):a.sourceType===2?(console.log(a),window.open(`/#/workbench/rapi-test?url=${a.config.baseURL}`,"_blank")):a.sourceType===3&&window.open(a.config.url,"_blank")};return l("div",{className:"flex flex-col h-full common-form items-stretch justify-items-stretch",children:[" ",l("div",{className:"bg-white flex flex-0 h-54px pl-11 items-center",children:[F==="setting"?l(o,{children:[l("div",{className:"cursor-pointer flex bg-[#F9F9F9FF] mr-6 py-0.5 px-2 items-center justify-evenly",children:[e(le,{width:12,height:7,src:"/assets/back.svg",alt:"\u8FD4\u56DE",preview:!1}),e("span",{className:"ml-1",onClick:()=>x("detail"),children:"\u8FD4\u56DE"})]}),e("div",{className:"font-medium",children:"\u9AD8\u7EA7\u8BBE\u7F6E"})]}):l(o,{children:[e("img",{className:"h-14px mr-1.5 w-14px",src:`/assets/workbench/panel-item-${D.toLowerCase()}.png`,alt:"\u6570\u636E\u6E90"}),a==null?void 0:a.name]}),e("div",{className:"flex-1"}),F==="detail"?l(o,{children:[e(Fe,{checked:(a==null?void 0:a.switch)===1,checkedChildren:"\u5F00\u542F",unCheckedChildren:"\u5173\u95ED",onChange:w,className:"mr-4"}),a.sourceType===1?e(G,{className:"btn-test ml-4 ",onClick:()=>I(`/workbench/modeling?id=${a==null?void 0:a.id}`),children:"\u8BBE\u8BA1"}):e(o,{}),a.sourceType!==4?l(o,{children:[a.sourceType===2?e("a",{href:`/api/v1/file/downloadFile?type=1&fileName=${a.config.filePath}`,children:e(G,{className:"btn-test ml-4 mr-4",children:"\u6D4B\u8BD5"})}):e(G,{className:"btn-test ml-4 mr-4",onClick:()=>y("bottomLeft"),children:"\u6D4B\u8BD5"}),e(G,{className:"btn-save mr-11",onClick:()=>x("form"),children:"\u7F16\u8F91"})]}):e(o,{})]}):null]}),e("div",{className:"bg-white rounded-4px flex-1 mx-3 mt-3 min-h-0 px-8 pt-5 overflow-y-auto",children:a.sourceType===1?e(ua,{content:a,type:F}):a.sourceType===2?e(ba,{content:a,type:F}):a.sourceType===3?e(pa,{content:a,type:F}):a.sourceType===4?e(Qe,{content:a}):e(o,{})})]})}const ga="_pannel_1lnw9_1",ya="_title_1lnw9_6",il={pannel:ga,title:ya,"datasource-collapse":"_datasource-collapse_1lnw9_15","datasource-border":"_datasource-border_1lnw9_24"},rl={"delete-label":"_delete-label_wrs9f_1"};function cl(a,F){switch(F.type){case"fetched":return F.data;case"selected":return a;case"added":return[...a,F.data];case"changed":return a.map(x=>x.id===F.data.id?F.data:x);case"deleted":return a.filter(x=>x.id!==F.data.id);default:return a}}export{Ie as D,ie as a,nl as b,tl as c,il as d,cl as e,ul as f,rl as s};
